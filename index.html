<!doctype html>
<meta charset="utf-8">
<title>Try JSON Refactor</title>

<link rel="stylesheet" href="style.css">

<div class="header">
  <h1>Try JSON Refactor</h1>
</div>
<div class="try">
  <div class="block source">
    <h2>Source <em>the JSON (object-style) you put in</em></h2>
    <div class="wrapper">
      <textarea></textarea>
    </div>
  </div>
  <div class="block map">
    <h2>Map <em>the rules you set</em></h2>
    <div class="wrapper">
      <textarea></textarea>
    </div>
  </div>
  <div class="block target">
    <h2>Target <em>the refactored you get</em></h2>
    <div class="wrapper">
      <textarea disabled></textarea>
    </div>
  </div>
</div>

<script src="dist/json-refactor.es5.min.js"></script>
<script>
  'use strict';

  var $source = document.querySelector('.source textarea');
  var $map = document.querySelector('.map textarea');
  var $target = document.querySelector('.target textarea');
  document.querySelector('.try').addEventListener('input', function () {
    var source = $source.value.trim();
    var map = $map.value.trim();

    if (source === '' || map === '') return;
    if (!/[{[]/.test(source[0]) || source[source.length - 1] !== {'{': '}', '[': ']'}[source[0]]) return;
    if (map[0] != '{' || map[map.length - 1] != '}') return;

    try {
      $target.value = JSON.stringify(jsonRefactor(eval('(' + $source.value + ')'), eval('(' + $map.value + ')')), null, 2);
    } catch (e) {
      $target.value = e.message;
    }
  });
</script>