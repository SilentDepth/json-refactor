{"version":3,"file":"json-refactor.es5.min.js","sources":["../src/parser.js","../src/getter.js","../src/setter.js","../src/index.js"],"sourcesContent":["'use strict';\r\n\r\n/**\r\n * Parse a key path expression for an object\r\n * @param obj {object}\r\n * @param path {string}\r\n * @param makeCrumbs {boolean} To add non-exist middle property\r\n * @returns {{parent: *, key: string}}\r\n */\r\n\r\nfunction parser(obj, path, makeCrumbs = false) {\r\n\r\n\r\n  let parent = obj;\r\n  let key = '';\r\n  let tokens = path.split('.');\r\n  let len = tokens.length;\r\n  let isArray;\r\n  let arrIdx;\r\n\r\n  tokens.forEach((token, idx) => {\r\n    [, key, isArray, arrIdx] = /(.+?)(\\[(\\d+)?])?$/.exec(token);\r\n\r\n    if (isArray) {\r\n      if (makeCrumbs && !(parent[key] instanceof Array)) {\r\n        parent[key] = [];\r\n      }\r\n      parent = parent[key];\r\n      key = arrIdx || parent.length;\r\n    }\r\n\r\n    if (idx < len - 1) {\r\n      if (makeCrumbs && !parent[key]) {\r\n        parent[key] = {};\r\n      }\r\n      parent = parent[key];\r\n    }\r\n  });\r\n\r\n  if (parent) {\r\n    return {parent, key};\r\n  }\r\n}\r\n\r\nexport default parser;\r\n","'use strict';\r\n\r\nimport parser from './parser.js';\r\n\r\nfunction getter(source, sourceKey) {\r\n  let key = sourceKey;\r\n  let needIteration = false;\r\n\r\n  if (/\\[]$/.test(key)) {\r\n    needIteration = true;\r\n    key = key.slice(0, -2);\r\n  }\r\n\r\n  let pathObj = parser(source, key);\r\n\r\n  if (pathObj) {\r\n    return {\r\n      needIteration,\r\n      value: pathObj.parent[pathObj.key],\r\n    };\r\n  }\r\n}\r\n\r\nexport default getter;","'use strict';\r\n\r\nimport parser from './parser.js';\r\n\r\nfunction setter(target, targetKey, value = null, setUndefined = false) {\r\n  if (value === undefined) {\r\n    if (!setUndefined) {\r\n      return;\r\n    }\r\n  } else {\r\n    if (typeof targetKey === 'function') {\r\n      let result = targetKey(value);\r\n      if (result === undefined) {\r\n        return\r\n      }\r\n      ({key: targetKey, value} = result);\r\n    } else if (/^!/.test(targetKey)) {\r\n      value = ['1', 'true', 'yes', 't', 'y'].indexOf(('' + value).toLowerCase()) >= 0;\r\n      if (/^!!/.test(targetKey)) {\r\n        targetKey = targetKey.slice(2);\r\n      } else {\r\n        targetKey = targetKey.slice(1);\r\n        value = !value;\r\n      }\r\n    } else if (/^\\+/.test(targetKey)) {\r\n      targetKey = targetKey.slice(1);\r\n      value = +value;\r\n    }\r\n  }\r\n\r\n  let pathObj = parser(target, targetKey, true);\r\n  pathObj.parent[pathObj.key] = value instanceof Object ? JSON.parse(JSON.stringify(value)) : value;\r\n}\r\n\r\nexport default setter;","'use strict';\r\n\r\nimport getter from './getter.js';\r\nimport setter from './setter.js';\r\n\r\nconst CONFIG_KEY = '__json-refactor__';\r\n\r\nfunction jsonRefactor(source, map, target = {}) {\r\n  const {setUndefined = false} = map[CONFIG_KEY] || {};\r\n\r\n  // TODO: parameters validation\r\n\r\n  const mapKeys = Reflect.ownKeys(map).filter(key => key !== CONFIG_KEY);\r\n  mapKeys.forEach(sourceKey => {\r\n    let got = getter(source, sourceKey);\r\n    if (got.value === undefined && !setUndefined) return;\r\n    if (got.needIteration) {\r\n      got.value.forEach(source => {\r\n        let refactored = jsonRefactor(source, map[sourceKey].map);\r\n        setter(target, map[sourceKey].key, refactored, setUndefined);\r\n      });\r\n    } else {\r\n      setter(target, map[sourceKey], got.value, setUndefined);\r\n    }\r\n  });\r\n\r\n  return target;\r\n}\r\n\r\nexport default jsonRefactor;\r\n"],"names":[],"mappings":"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"}